<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Forgot Password</title>
    <link rel="stylesheet" href="../../css/forgotPassword.css" />
    <link rel="stylesheet" href="../../css/patientLogin.css" />

<body>
    <header>
        <div class="logo-container">
            <img class="logo" src="https://ik.imagekit.io/wbhsmslogo/Nav_LogoClosed.png?updatedAt=1751197276128"
                alt="CHO Koronadal Logo" />
        </div>
    </header>
    <section class="homepage">
        <div class="registration-box">
            <h2 style="margin:0 0 20px 0;">Forgot Password</h2>
            <form id="forgotForm" class="form" autocomplete="off" novalidate>
                <label for="identifier">Enter your Patient ID or Email Address</label>
                <input type="text" id="identifier" name="identifier" class="input-field" required
                    placeholder="Patient ID or Email" />
                <div id="error" class="error" role="alert" aria-live="polite" style="display:none"></div>
                <div class="form-footer">
                </div>
            </form>
            <div class="form-footer">
                <div class="reminder" style="font-size:0.98em; color:#555; margin:8px 0 16px 0;text-align: justify;font-size: smaller;">
                    <strong>Reminder:</strong> <i>Please type your registered email or your respective Patient ID (e.g. <b>P000001</b>).<br>
                    If you forgot your email or Patient ID, please contact your administrator or your local health worker for assistance.</i>
                </div>
            </div>
            <div style="text-align:center; margin-top:18px;">
                <button id="backBtn" type="button" class="btn"
                    style="background:#eee; color:#333; padding:8px 24px; border-radius:4px; text-decoration:none; border:none; display:inline-block; margin-right:8px;">Back
                    to Login</button>
                <button id="submitBtn" type="submit" class="btn"
                    style="background:#007bff; color:#fff; padding:8px 24px; border-radius:4px; text-decoration:none; border:none; display:inline-block;">Send
                    OTP <i class="fa-solid fa-arrow-right"></i></button>
            </div>
        </div>
    </section>
    <script>
        const form = document.getElementById('forgotForm');
        const error = document.getElementById('error');
        const submitBtn = document.getElementById('submitBtn');
        const backBtn = document.getElementById('backBtn');
        backBtn.addEventListener('click', function () {
            window.location.href = 'patientLogin.php';
        });
        function showError(msg) {
            error.textContent = msg;
            error.style.display = 'block';
            setTimeout(() => { error.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 50);
        }
        function clearError() {
            error.textContent = '';
            error.style.display = 'none';
        }
        form.addEventListener('submit', function (e) {
            e.preventDefault();
            clearError();
            const identifier = document.getElementById('identifier').value.trim();
            if (!identifier) {
                showError('Please enter your Patient ID or Email Address.');
                return;
            }
            submitBtn.disabled = true;
            fetch('forgotPassword.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: 'identifier=' + encodeURIComponent(identifier)
            })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        window.location.href = 'verifyOTPPassword.html?reset=1';
                    } else {
                        showError(data.message || 'No matching user found.');
                        submitBtn.disabled = false;
                    }
                })
                .catch(() => {
                    showError('Server error. Please try again.');
                    submitBtn.disabled = false;
                });
        });
    </script>
</body>

</html>