<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Forgot Password</title>
    <link rel="stylesheet" href="css/forgotPassword.css" />
</head>

<body>
    <header>
        <div class="logo-container">
            <img class="logo" src="https://ik.imagekit.io/wbhsmslogo/Nav_LogoClosed.png?updatedAt=1751197276128"
                alt="CHO Koronadal Logo" />
        </div>
    </header>
    <section class="homepage">
        <div class="registration-box">
            <h2>Forgot Password</h2>
            <form id="forgotForm" class="form" autocomplete="off" novalidate>
                <label for="identifier">Enter your Patient ID or Email Address</label>
                <input type="text" id="identifier" name="identifier" class="input-field" required
                    placeholder="Patient ID or Email" />
                <div id="error" class="error" role="alert" aria-live="polite" style="display:none"></div>
                <div class="form-footer">
                    <button id="submitBtn" type="submit" class="btn">Send OTP <i
                            class="fa-solid fa-arrow-right"></i></button>
                </div>
            </form>
        </div>
    </section>
    <script>
        const form = document.getElementById('forgotForm');
        const error = document.getElementById('error');
        const submitBtn = document.getElementById('submitBtn');
        function showError(msg) {
            error.textContent = msg;
            error.style.display = 'block';
            setTimeout(() => { error.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 50);
        }
        function clearError() {
            error.textContent = '';
            error.style.display = 'none';
        }
        form.addEventListener('submit', function (e) {
            e.preventDefault();
            clearError();
            const identifier = document.getElementById('identifier').value.trim();
            if (!identifier) {
                showError('Please enter your Patient ID or Email Address.');
                return;
            }
            submitBtn.disabled = true;
            fetch('forgotPassword.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: 'identifier=' + encodeURIComponent(identifier)
            })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        window.location.href = 'verifyOTPPassword.html?reset=1';
                    } else {
                        showError(data.message || 'No matching user found.');
                        submitBtn.disabled = false;
                    }
                })
                .catch(() => {
                    showError('Server error. Please try again.');
                    submitBtn.disabled = false;
                });
        });
    </script>
</body>

</html>